<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>타로 카드 선택 화면</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        #tarot-deck {
            position: relative;
            width: 400px;
            height: 300px;
        }

        .tarot-card {
            position: absolute;
            width: 100px;
            height: 150px;
            background-color: #f0e68c;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, top 0.3s ease, left 0.3s ease;
            cursor: pointer;
        }

        .tarot-card:hover {
            transform: scale(1.1);
            top: -10px;
        }

        #selected-area {
            margin-top: 50px;
            text-align: center;
        }

        .selected-card {
            position: relative;
            margin: 10px;
            width: 100px;
            height: 150px;
            background-color: #f0e68c;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .selected {
            position: relative;
            transform: none;
            left: 0;
            top: 0;
        }

        .card-selected {
            transition: transform 0.5s ease, left 0.5s ease, top 0.5s ease;
            transform: scale(1.3);
            left: 150px;
            top: 100px;
        }

        .position-0 {
            left: 0;
        }

        .position-1 {
            left: 30px;
        }

        .position-2 {
            left: 60px;
        }

        .position-3 {
            left: 90px;
        }

        .position-4 {
            left: 120px;
        }
    </style>
</head>
<body>
<div id="tarot-deck">
    <!-- 타로 카드가 겹쳐진 상태로 나열 -->
    <div class="tarot-card position-0" id="card1"></div>
    <div class="tarot-card position-1" id="card2"></div>
    <div class="tarot-card position-2" id="card3"></div>
    <div class="tarot-card position-3" id="card4"></div>
    <div class="tarot-card position-4" id="card5"></div>
</div>

<div id="selected-area">
    <h3>선택된 카드</h3>
</div>

<script>
    let isDragging = false;

    document.querySelectorAll('.tarot-card').forEach(card => {
        card.addEventListener('touchstart', () => {
            isDragging = false;
        });

        card.addEventListener('touchmove', () => {
            isDragging = true;
            card.style.transform = 'scale(1.1)';
            card.style.top = '-10px';
        });

        card.addEventListener('touchend', () => {
            if (!isDragging) {
                // 터치 드래그 없이 손을 뗀 경우, 클릭 효과 적용
                cardClickHandler(card);
            }
            // 드래그 효과 원상복귀
            card.style.transform = 'none';
            card.style.top = '0';
        });
    });

    function cardClickHandler(card) {
        // 이미 선택된 카드가 있는 경우 해당 카드의 클래스 제거
        const previouslySelectedCard = document.querySelector('.card-selected');
        if (previouslySelectedCard) {
            previouslySelectedCard.classList.remove('card-selected');
        }

        // 선택된 카드에 대해 애니메이션 설정
        // CSS 클래스를 추가하여 애니메이션을 적용
        card.classList.add('card-selected');

        // 애니메이션 완료 후 선택된 카드란으로 이동
        card.addEventListener('transitionend', (event) => {
            if (event.propertyName === 'transform') {
                const selectedArea = document.getElementById('selected-area');
                // 선택된 카드는 tarot-card 클래스 제거 후 selected-card 클래스를 추가
                card.classList.remove('tarot-card', 'card-selected', 'position-0', 'position-1', 'position-2', 'position-3', 'position-4');
                card.classList.add('selected-card', 'selected');
                // 선택된 영역에 카드 추가
                selectedArea.appendChild(card);
            }
        }, { once: true });
    }

    // 부모 컨테이너에서 이벤트 위임을 사용하여 클릭 이벤트 처리
    document.getElementById('tarot-deck').addEventListener('click', (event) => {
        const card = event.target;
        // 이벤트 타겟이 정확히 tarot-card인지 확인하여 이벤트 필터링 강화
        if (card.classList.contains('tarot-card') && card.parentElement.id === 'tarot-deck') {
            cardClickHandler(card);
        }
    });
</script>
</body>
</html>